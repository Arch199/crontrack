{% extends 'crontrack/base.html' %}

{% load static %}
{% load timezones %}

{% block title %} {{ user.username }}'s profile {% endblock %}
{% block head_extra %} {% include 'crontrack/js/intl-tel-input.html' with type='css' %} {% endblock %}

{% block content %}
	<div class="hcenter">
		{% if user.is_authenticated %}
			<h2>{{ user.username }}'s profile</h2>
			<div class="center">
				<h3>Account Settings</h3>
				<form action="{% url 'crontrack:profile' %}" method="post">
					{% csrf_token %}
					<table class="form">
						<tr>
							<td><label for="timezoneSelector">Timezone</label></td>
							<td>{% timezone_selector prefill.timezone|default:user.profile.timezone %}</td>
						</tr>
						<tr>
							<td><label for="alert_method">Alert method</label></td>
							<td>
								<label for="alertMethodEmail">Email</label>
								<input type="radio" name="alert_method" id="alertMethodEmail" value="E" checked>
								<label for="alertMethodText">Text</label>
								<input type="radio" name="alert_method" id="alertMethodText" value="T" maxlength="15">
							</td>
						</tr>
						<tr id="emailRow">
							<td><label for="email">Email address</label></td>
							<td><input type="email" name="email" id="email" value="{{ user.email }}"></td>
						</tr>
						<tr id="phoneRow" style="display: none">
							<td><label for="phone">Phone number</label></td>
							<td><input type="tel" name="phone" id="phone" value="{{ user.profile.phone }}"></td>
						</tr>
						<tr>
							<td><label for="alert_buffer">Time between alerts (min)</label></td>
							<td><input type="number" name="alert_buffer" value="{{ user.profile.alert_buffer }}"></td>
						</tr>
					</table>
					<br><center><input type="submit" value="Confirm"></center>
				</form>
				{% for error in form.errors.values %}
					<br><span class="errorMessage">
						{% for message in error %}
							<br>{{ message }}
						{% endfor %}
					</span>
				{% endfor %}
				<br>
				{% if success_message %}
					<br><span class="successMessage">{{ success_message }}</span>
				{% endif %}
			</div>
		{% else %}
			<p>You are not logged in.</p> <!-- TODO: make a template tag for this -->
			<a href="{% url 'crontrack:login' %}">Log in</a>
		{% endif %}
	</div>
	{% include 'crontrack/js/jquery.html' %}
	{% include 'crontrack/js/intl-tel-input.html' %}
	<script>	
		$(document).ready(function() {
			$('#alertMethodEmail').on('click', function() {
				$('#emailRow').show();
				$('#phoneRow').hide();
			});
			$('#alertMethodText').on('click', function() {
				$('#phoneRow').show();
				$('#emailRow').hide();
			});
			
			{% if user.profile.alert_method == user.profile.SMS or prefill.alert_method == user.profile.SMS %}
				$('#alertMethodText').trigger('click');
			{% endif %}
		});
	</script>
{% endblock %}