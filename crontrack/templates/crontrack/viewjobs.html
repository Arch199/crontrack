{% extends 'crontrack/base.html' %}

{% load static %}

{% block title %} View running jobs {% endblock %}

{% block content %}
	<div class="hcenter">
		<h2>View running jobs</h2>
		{% if user.is_authenticated %}
			{% if groups %}
				<p class="note">
					Currently displaying in timezone "{{ user.profile.timezone }}."
					(<a href="{% url 'crontrack:profile' %}">change</a>)
				</p>
				<table class="dbRows">
					<thead><tr>
						<th>Name</th>
						<th>Cron Schedule String</th>
						<th>Time Window (min)</th>
						<th>Next Run Time</th>
						<th>Last Notified</th>
					</tr></thead>
					{% for group in groups %}
						<tr><td colspan="5" class="rowGroupHeader open" onclick="toggleRowGroup(event)">
							<span>{{ group.name }}</span>
							<form action="{% url 'crontrack:edit_group' %}" method="post">
								{% csrf_token %}
								<input type="hidden" name="group" value="{{ group.id|default:'None' }}">
								<input type="submit" value="Edit group">
							</form>
						</td></tr>
						<tbody class="rowGroupContent open">
							{% if group.description %}
								<tr><td colspan="5" class="rowGroupInfo">{{ group.description }}</td></tr>
							{% endif %}
							{% for job in group.jobs %}
								<tr>
									<td>{{ job.name }}</td>
									<td>{{ job.schedule_str }}</td>
									<td>{{ job.time_window }}</td>
									<td>{{ job.next_run }}</td>
									<td>{{ job.last_notified }}</td>
									
									<!-- TODO: add dropdown for description/UUID to each job -->
								</tr>
							{% endfor %}
						</tbody>
					{% endfor %}
				</table>
			{% else %}
				<p>No jobs to view.</p>
			{% endif %}
			<br><a href="{% url 'crontrack:add_job' %}" class="button">Add a new job</a>
		{% else %}
			<p>You are not logged in.</p>
			<a href="{% url 'crontrack:login' %}">Log in</a>
		{% endif %}
	</div>
	<script src="{% static 'crontrack/rowgroup.js' %}"></script>
{% endblock %}